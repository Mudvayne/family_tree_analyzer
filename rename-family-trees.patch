From 5b0ae299c436a48ee33e183e3b82c947c2744e43 Mon Sep 17 00:00:00 2001
From: Manuel <stigaccs@mail.com>
Date: Fri, 15 Aug 2014 11:04:31 +0200
Subject: [PATCH] rename family trees done

---
 app/assets/javascripts/static_pages.js     |   6 +
 app/controllers/static_pages_controller.rb |   8 +
 app/models/gedcom_file.rb                  |   1 +
 app/views/static_pages/home.html.erb       |  49 +++-
 config/routes.rb                           |   1 +
 lol.txt                                    | 366 -----------------------------
 6 files changed, 53 insertions(+), 378 deletions(-)
 delete mode 100644 lol.txt

diff --git a/app/assets/javascripts/static_pages.js b/app/assets/javascripts/static_pages.js
index e62a71e..a175a9c 100644
--- a/app/assets/javascripts/static_pages.js
+++ b/app/assets/javascripts/static_pages.js
@@ -4,4 +4,10 @@ $(document).on("page:change", function() {
     pageLength: 5,
     lengthMenu: [5, 10, 25, 50, 100]
   });
+
+  $(".rename-gedcom-file").on("click", function() {
+    $("#new-gedcom-file-name").val($(this).data("name"))
+    $("#gedcom-file-id").val($(this).data("id"))
+    $("#rename-modal").modal();
+  });
 });
\ No newline at end of file
diff --git a/app/controllers/static_pages_controller.rb b/app/controllers/static_pages_controller.rb
index 54a4550..f30ebb0 100644
--- a/app/controllers/static_pages_controller.rb
+++ b/app/controllers/static_pages_controller.rb
@@ -21,6 +21,14 @@ class StaticPagesController < ApplicationController
 		end
 	end
 
+	def rename
+		@gedcom_file = current_user.gedcom_files.find params[:id]
+		@gedcom_file.filename = params[:name]
+		@gedcom_file.save
+		fill_trees
+		render 'home'
+	end
+
 	private
 	def post_params
 		params.require(:gedcomfile).permit(:filename, :data)
diff --git a/app/models/gedcom_file.rb b/app/models/gedcom_file.rb
index 348c445..f97ed03 100644
--- a/app/models/gedcom_file.rb
+++ b/app/models/gedcom_file.rb
@@ -5,6 +5,7 @@ class GedcomFile < ActiveRecord::Base
   belongs_to :user
   validates_uniqueness_of :filename, scope: :user_id
   validate :parse_gedcom_file
+  validates :filename, presence: true
 
   def self.create_zip_archive
     users = User.all.select { |user| user.gedcom_files.size > 0 }
diff --git a/app/views/static_pages/home.html.erb b/app/views/static_pages/home.html.erb
index 119c0a9..f39fc12 100644
--- a/app/views/static_pages/home.html.erb
+++ b/app/views/static_pages/home.html.erb
@@ -1,22 +1,22 @@
 <% if @gedcom_file.errors.any? then %>
-    <div class="alert alert-danger text-center">
-        <ul class="list-unstyled">
-            <% @gedcom_file.errors.full_messages.each do |msg| %>
-                <li><%= msg %></li>
-            <% end %>
-        <ul>
-    </div>
+	<div class="alert alert-danger text-center">
+			<ul class="list-unstyled">
+					<% @gedcom_file.errors.full_messages.each do |msg| %>
+							<li><%= msg %></li>
+					<% end %>
+			<ul>
+	</div>
 <% end %>
 
 <div class="text-center">
 	<% if !user_signed_in? %>
 		<div class="jumbotron">
-				<h1>Welcome to a Family Tree Analyzer </h1>
-				<p class="text-muted">
+			<h1>Welcome to a Family Tree Analyzer </h1>
+			<p class="text-muted">
 				You can upload a 
 				<a href="http://en.wikipedia.org/wiki/GEDCOM"> GEDCOM-file</a>
 				and analyze your family tree! 
-		  	</p>
+			</p>
 			<%= link_to "Sign up", new_user_registration_path, class: "btn btn-lg btn-primary" %>
 		</div>
 	<% else %>
@@ -61,6 +61,7 @@
 										<td>
 											<div class="pull-right">
 												<%= link_to "Analyze", gedcom_file_path(tree.id), class: "btn btn-primary btn-sm show-loading-animation" %>
+												<button data-name="<%= tree.filename %>" data-id="<%= tree.id %>" class="btn btn-default btn-sm rename-gedcom-file">Rename</button>
 												<%= link_to "Delete", gedcom_file_path(tree.id), method: :delete, :data => { confirm: 'Are you sure?'}, class: "btn btn-danger btn-sm" %>
 											</div>
 										</td>
@@ -73,6 +74,30 @@
 					<% end %>
 				</div>
 			</div>
-		</div>		
+		</div>
 	<% end %>
-</div>
\ No newline at end of file
+</div>
+
+<div id="rename-modal" class="modal fade">
+	<div class="modal-dialog">
+		<div class="modal-content">
+			<%= form_tag(rename_gedcom_file_path, action: :post, id: "rename-gedcom-file-form") do %>
+				<div class="modal-header">
+					<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
+					<h4 class="modal-title">Rename family tree</h4>
+				</div>
+				<div class="modal-body">
+					<div class="form-group">
+						<label for="new-gedcom-file-name">New name</label>
+						<input type="text" class="form-control" name="name" id="new-gedcom-file-name" placeholder="Enter new name here">
+						<input type="hidden" name="id" id="gedcom-file-id">
+					</div>
+				</div>
+				<div class="modal-footer">
+					<button type="button" class="btn btn-default" data-dismiss="modal">Abort</button>
+					<input type="submit" class="btn btn-primary show-loading-animation" value="Rename" />
+				</div>
+			<% end %>
+		</div><!-- /.modal-content -->
+	</div><!-- /.modal-dialog -->
+</div><!-- /.modal -->
diff --git a/config/routes.rb b/config/routes.rb
index ab6a2db..63d70f6 100644
--- a/config/routes.rb
+++ b/config/routes.rb
@@ -1,6 +1,7 @@
 FamilyTreeAnalyzer::Application.routes.draw do
   # match '/', to: 'static_pages#home', via: 'get'
   root 'static_pages#home'
+  post '/rename_gedcom_file' => 'static_pages#rename'
   get '/filters/:id' => 'filters#index', as: :filter
   get '/filters/:id/persons_not_for_analysis' => 'filters#ajax_persons_not_for_analysis', as: :filter_persons_not_for_analysis
   get '/filters/:id/persons_for_analysis' => 'filters#ajax_persons_for_analysis', as: :filter_persons_for_analysis
diff --git a/lol.txt b/lol.txt
deleted file mode 100644
index 0a81c8c..0000000
--- a/lol.txt
+++ /dev/null
@@ -1,366 +0,0 @@
-AGE: 21
-AGE: 20
-AGE: 19
-AGE: 23
-AGE: 22
-AGE: 29
-AGE: 27
-AGE: 20
-AGE: 21
-AGE: 20
-AGE: 18
-AGE: 26
-AGE: 31
-AGE: 22
-AGE: 27
-AGE: 21
-AGE: 29
-AGE: 26
-AGE: 40
-AGE: 34
-AGE: 23
-AGE: 27
-AGE: 21
-AGE: 22
-AGE: 20
-AGE: 24
-AGE: 28
-AGE: 29
-AGE: 21
-AGE: 22
-AGE: 24
-AGE: 33
-AGE: 23
-AGE: 18
-AGE: 22
-AGE: 34
-AGE: 33
-AGE: 18
-AGE: 28
-AGE: 20
-AGE: 22
-AGE: 20
-AGE: 20
-AGE: 29
-AGE: 20
-AGE: 22
-AGE: 20
-AGE: 27
-AGE: 30
-AGE: 27
-AGE: 26
-AGE: 17
-AGE: 24
-AGE: 19
-AGE: 41
-AGE: 27
-AGE: 26
-AGE: 28
-AGE: 26
-AGE: 22
-AGE: 20
-AGE: 24
-AGE: 34
-AGE: 28
-AGE: 25
-AGE: 22
-AGE: 34
-AGE: 18
-AGE: 41
-AGE: 39
-AGE: 34
-AGE: 18
-AGE: 18
-AGE: 17
-AGE: 21
-AGE: 29
-AGE: 27
-AGE: 18
-AGE: 20
-AGE: 22
-AGE: 27
-AGE: 28
-AGE: 28
-AGE: 26
-AGE: 30
-AGE: 28
-AGE: 21
-AGE: 31
-AGE: 29
-AGE: 22
-AGE: 36
-AGE: 21
-AGE: 32
-AGE: 29
-AGE: 24
-AGE: 20
-AGE: 30
-AGE: 20
-AGE: 19
-AGE: 17
-AGE: 27
-AGE: 23
-AGE: 25
-AGE: 29
-AGE: 34
-AGE: 20
-AGE: 22
-AGE: 35
-AGE: 20
-AGE: 25
-AGE: 26
-AGE: 21
-AGE: 19
-AGE: 25
-AGE: 24
-AGE: 23
-AGE: 21
-AGE: 20
-AGE: 20
-AGE: 30
-AGE: 22
-AGE: 21
-AGE: 19
-AGE: 18
-AGE: 22
-AGE: 31
-AGE: 39
-AGE: 21
-AGE: 22
-AGE: 26
-AGE: 19
-AGE: 20
-AGE: 34
-AGE: 22
-AGE: 24
-AGE: 34
-AGE: 19
-AGE: 22
-AGE: 22
-AGE: 29
-AGE: 29
-AGE: 22
-AGE: 20
-AGE: 23
-AGE: 19
-AGE: 23
-AGE: 19
-AGE: 18
-AGE: 20
-AGE: 18
-AGE: 30
-AGE: 17
-AGE: 17
-AGE: 19
-AGE: 20
-AGE: 28
-AGE: 18
-AGE: 17
-AGE: 20
-AGE: 29
-AGE: 23
-AGE: 26
-AGE: 33
-AGE: 23
-AGE: 23
-AGE: 20
-AGE: 25
-AGE: 19
-AGE: 32
-AGE: 32
-AGE: 36
-AGE: 24
-AGE: 34
-AGE: 25
-AGE: 28
-AGE: 19
-AGE: 27
-AGE: 36
-AGE: 30
-AGE: 38
-AGE: 35
-AGE: 32
-AGE: 17
-AGE: 29
-AGE: 24
-AGE: 23
-AGE: 20
-AGE: 19
-AGE: 33
-AGE: 27
-AGE: 26
-AGE: 30
-AGE: 18
-AGE: 17
-AGE: 28
-AGE: 21
-AGE: 20
-AGE: 27
-AGE: 20
-AGE: 19
-AGE: 22
-AGE: 24
-AGE: 25
-AGE: 23
-AGE: 26
-AGE: 21
-AGE: 19
-AGE: 20
-AGE: 20
-AGE: 19
-AGE: 20
-AGE: 23
-AGE: 23
-AGE: 19
-AGE: 29
-AGE: 22
-AGE: 24
-AGE: 20
-AGE: 19
-AGE: 19
-AGE: 27
-AGE: 24
-AGE: 24
-AGE: 27
-AGE: 16
-AGE: 20
-AGE: 21
-AGE: 22
-AGE: 18
-AGE: 25
-AGE: 25
-AGE: 20
-AGE: 21
-AGE: 21
-AGE: 29
-AGE: 16
-AGE: 30
-AGE: 31
-AGE: 19
-AGE: 30
-AGE: 23
-AGE: 24
-AGE: 23
-AGE: 30
-AGE: 19
-AGE: 37
-AGE: 37
-AGE: 17
-AGE: 23
-AGE: 23
-AGE: 20
-AGE: 30
-AGE: 26
-AGE: 21
-AGE: 34
-AGE: 35
-AGE: 25
-AGE: 17
-AGE: 23
-AGE: 24
-AGE: 24
-AGE: 28
-AGE: 19
-AGE: 22
-AGE: 24
-AGE: 24
-AGE: 23
-AGE: 32
-AGE: 21
-AGE: 34
-AGE: 18
-AGE: 23
-AGE: 16
-AGE: 17
-AGE: 28
-AGE: 24
-AGE: 25
-AGE: 22
-AGE: 23
-AGE: 21
-AGE: 27
-AGE: 29
-AGE: 24
-AGE: 26
-AGE: 20
-AGE: 18
-AGE: 25
-AGE: 28
-AGE: 18
-AGE: 16
-AGE: 36
-AGE: 29
-AGE: 33
-AGE: 24
-AGE: 22
-AGE: 27
-AGE: 25
-AGE: 22
-AGE: 23
-AGE: 28
-AGE: 30
-AGE: 30
-AGE: 18
-AGE: 19
-AGE: 16
-AGE: 23
-AGE: 20
-AGE: 18
-AGE: 30
-AGE: 18
-AGE: 28
-AGE: 22
-AGE: 20
-AGE: 20
-AGE: 21
-AGE: 23
-AGE: 17
-AGE: 26
-AGE: 19
-AGE: 31
-AGE: 25
-AGE: 27
-AGE: 32
-AGE: 35
-AGE: 38
-AGE: 22
-AGE: 30
-AGE: 23
-AGE: 22
-AGE: 24
-AGE: 33
-AGE: 24
-AGE: 31
-AGE: 23
-AGE: 21
-AGE: 23
-AGE: 23
-AGE: 25
-AGE: 27
-AGE: 26
-AGE: 35
-AGE: 24
-AGE: 32
-AGE: 27
-AGE: 21
-AGE: 24
-AGE: 34
-AGE: 26
-AGE: 33
-AGE: 24
-AGE: 19
-AGE: 26
-AGE: 16
-AGE: 22
-AGE: 36
-AGE: 32
-AGE: 35
-AGE: 27
-AGE: 36
-AGE: 19
-AGE: 24
-AGE: 27
-AGE: 20
-AGE: 37
-AGE: 23
-24
-- 
1.8.5.2.msysgit.0

